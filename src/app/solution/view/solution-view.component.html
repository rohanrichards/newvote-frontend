<app-loader [isLoading]="isLoading"
    size="1.5"></app-loader>

<ng-container 
	*ngIf="isLoading;
	then skeletonHeader;
	else mainHeader">
</ng-container>

<ng-container *ngIf="isLoading;
	then skeletonSolutions;
	else mainSolutions">
</ng-container>

<ng-template #skeletonHeader>
	<app-skeleton-header [noLogo]=true >
	</app-skeleton-header>
	<app-skeleton-panel [hasVote]=true>
	</app-skeleton-panel>
</ng-template>

<ng-template #skeletonSolutions>
	<div class="container"
		fxLayout="column"
		fxLayoutAlign="center start"
		>
		<div class="skeleton-card-list"
			>
			<app-skeleton-text-bar [isSubtitle]=true [width]="150">
			</app-skeleton-text-bar>

			<app-skeleton-wide-card
				[showImage]=true
				[showContent]=true
				[showActions]=true
				[showChildren]=true
			>
			</app-skeleton-wide-card>
			<app-skeleton-wide-card
				[showImage]=true
				[showContent]=true
				[showActions]=true
			>
			</app-skeleton-wide-card>
			<app-skeleton-wide-card
				[showImage]=true
				[showContent]=true
				[showActions]=true
			>
			</app-skeleton-wide-card>
		</div>	
	</div>
</ng-template>

<ng-template #mainHeader>
	<mat-toolbar color="primary"
		class="header-info-panel"
		*ngIf="solution">
		<div class="image-container"
			fxLayout="column"
			[style.background-image]="solution.imageUrl ?
						'url(' + replaceImageUrl(solution.imageUrl) + ')'
						: ''">
			<div class="admin-panel"
				*ngIf="auth.isModerator(solution)"
				fxLayout="column"
				fxLayoutAlign="center end">
				<div class="button-panel">
					<button mat-icon-button
						matTooltip="Create a new Solution"
						color="accent"
						routerLink="/solutions/create">
						<mat-icon aria-label="Create a new Solution">add</mat-icon>
					</button>
					<button mat-icon-button
						matTooltip="Add a Action for this Solution"
						color="accent"
						routerLink="/proposals/create/{{solution._id}}">
						<mat-icon aria-label="Add a Action for this Solution">playlist_add</mat-icon>
					</button>
					<button mat-icon-button
						matTooltip="Edit this Solution"
						color="accent"
						routerLink="/solutions/edit/{{solution._id}}">
						<mat-icon aria-label="Edit this solution">edit</mat-icon>
					</button>
					<button color="accent"
						*ngIf="solution.softDeleted"
						matTooltip="Restore this Solution"
						mat-icon-button
						(click)="onRestore()">
						<mat-icon aria-label="Restore content">restore</mat-icon>
					</button>
					<button mat-icon-button
						matTooltip="Remove this solution"
						*ngIf="!solution.softDeleted"
						color="accent"
						(click)="onSoftDelete()">
						<mat-icon aria-label="Remove solution">delete</mat-icon>
					</button>
					<button mat-icon-button
						matTooltip="Delete this Solution"
						color="warn"
						(click)="onDelete()">
						<mat-icon aria-label="Delete this solution forever">delete_forever</mat-icon>
					</button>
				</div>
			</div>
			<div fxLayout="row"
				fxFlex></div>
			<!-- <div fxLayout="column"
				fxLayoutAlign="start start">
			</div> -->
			<div fxLayout="row wrap"
				fxLayoutAlign="center center">
				<div fxFlex.gt-sm="690px"
					fxFlex.gt-md="800px">
					<app-share-buttons></app-share-buttons>
				</div>
			</div>
		</div>
		<div fxLayout="row wrap"
			class="description-bar"
			fxLayoutAlign="center center">
			<div fxFlex.gt-sm="690px"
				fxFlex.gt-md="800px">
				<div class="mat-display-1"
					translate>{{solution.title}}</div>
				<span class="mat-body">This is a solution for:
					<span *ngFor="let parent of solution.issues; let i = index">
						<a mat-button
							routerLink="/issues/{{parent._id}}">{{parent.title || parent.name}}</a>
					</span>
				</span>
				<app-more-less [displayText]="solution.description"
					maxHeight="200">
				</app-more-less>
				<mat-divider></mat-divider>
				<p></p>
				<div class="buttons">
					<app-vote-buttons (vote)="onVote($event, 'Solution')"
						[item]="solution">
					</app-vote-buttons>
				</div>
			</div>
		</div>
	</mat-toolbar>
</ng-template>


<ng-template #mainSolutions>
	<div class="container"
		*ngIf="solution"
		fxLayout="row wrap"
		fxLayoutAlign="center start">
		<div fxFlex.gt-sm="690px"
			fxFlex.gt-md="800px">
			<span class="mat-headline" *ngIf="solution && solution.proposals && solution.proposals.length > 0">Vote on Actions</span>
			<app-card-list path="/proposals"
				[items]="solution.proposals"
				model="Action"
				[showChildren]="false"
				[showParent]="true"
				parentPath="/solutions"
				parentPropName="solutions"
				(restore)="onRestoreProposal($event)"
				(softDelete)="onSoftDeleteProposal($event)"
				(delete)="onDeleteProposal($event)"
				(vote)="onVote($event, 'Proposal')"></app-card-list>
		</div>
	</div>
</ng-template>
